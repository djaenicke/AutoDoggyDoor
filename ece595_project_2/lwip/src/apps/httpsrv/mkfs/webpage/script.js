const max_intervals=5;var days=["m","t","w","th","f","sat","sun","all"],intervals=[],id_cntr=0;function set_trigger(){setTimeout(function(){load_data()},3e3)}function load_data(){var e=new XMLHttpRequest;e.onreadystatechange=function(){populate_data(e)},e.open("GET","load_data.cgi",!0),e.send(null)}function populate_data(e){if(4==e.readyState&&200==e.status){var t=JSON.parse(e.responseText);if(t.hasOwnProperty("zip")){document.getElementById("zip").value=t.zip}t.hasOwnProperty("intervals")&&t.intervals.forEach(e=>{e.hasOwnProperty("id")&&-1!=parseInt(e.id)&&add_time_interval(e)})}}function refresh_rtc_value(){var e=new XMLHttpRequest;e.onreadystatechange=function(){rtc_data_rxed(e)},e.open("GET","rtcdata.cgi",!0),e.send(null)}function rtc_data_rxed(e){if(4==e.readyState&&200==e.status){document.getElementById("rtc_time").innerHTML=e.responseText}}function refresh_weather_value(){var e=new XMLHttpRequest;e.onreadystatechange=function(){weather_data_rxed(e)},e.open("GET","weatherdata.cgi",!0),e.send(null)}function weather_data_rxed(e){if(4==e.readyState&&200==e.status){document.getElementById("weather_status").innerHTML="Weather Status: "+e.responseText}}function refresh_time_schedule_status(){var e=new XMLHttpRequest;e.onreadystatechange=function(){time_schedule_data_rxed(e)},e.open("GET","ts_status.cgi",!0),e.send(null)}function time_schedule_data_rxed(e){if(4==e.readyState&&200==e.status){document.getElementById("ts_status").innerHTML="Time Schedule Status: "+e.responseText}}function add_time_interval(e){if(num_valid_intervals()<max_intervals){var t=new Object;null==e?(t.id=id_cntr,t.days=0,t.start_time="",t.stop_time="",id_cntr++):(t.id=parseInt(e.id),t.days=parseInt(e.days),t.start_time=e.start_time,t.stop_time=e.end_time,id_cntr=parseInt(e.id)),t.invalidate=!1,intervals.push(t);const r=document.createElement("div");var a;r.className="row",r.id="row_"+id_cntr,(n=document.createElement("div")).className="time",(a=document.createElement("input")).className="time_input",a.type="time",a.id="start_"+id_cntr,a.addEventListener("input",set_start_time),a.value=t.start_time,n.appendChild(a),r.appendChild(n),(n=document.createElement("div")).className="time",(a=document.createElement("input")).className="time_input",a.type="time",a.id="stop_"+id_cntr,a.addEventListener("input",set_stop_time),a.value=t.stop_time,n.appendChild(a),r.appendChild(n);var n,s=0;days.forEach(e=>{var a=document.createElement("div");a.className="day",a.name=e;var n=document.createElement("input");n.className="day_select",n.type="checkbox",n.name=e,n.id=e+"_"+id_cntr,n.addEventListener("click",set_day),255==t.days?n.checked=!0:1==t.days>>s&&(n.checked=!0),a.appendChild(n),r.appendChild(a),s++}),(n=document.createElement("div")).className="day";var i=document.createElement("button");i.innerHTML="Delete",i.id="delete_"+id_cntr,i.className="delete_button",i.addEventListener("click",invalidate_interval),n.appendChild(i),r.appendChild(n),document.getElementById("intervals").appendChild(r)}else alert("Only 5 restricted intervals are allowed.")}function num_valid_intervals(){var e=0;return intervals.forEach(t=>{t.invalidate||e++}),e}function invalidate_interval(e){var t=get_interval_idx(e.srcElement.id);intervals[t].invalidate=!0;const a=document.getElementById("row_"+t);a.parentNode.removeChild(a)}function set_start_time(e){var t=get_interval_idx(e.srcElement.id);if(""!=intervals[t].stop_time){var a=String(e.srcElement.value).split(":"),n=intervals[t].stop_time.split(":");a[0]>n[0]?(alert("Start time cannot be after stop time!"),e.srcElement.value=""):a[0]==n[0]&&a[1]>n[1]?(alert("Start time cannot be after stop time!"),e.srcElement.value=""):intervals[t].start_time=e.srcElement.value}else intervals[t].start_time=e.srcElement.value;console.log(t),console.log(intervals[t].start_time)}function set_stop_time(e){var t=get_interval_idx(e.srcElement.id);if(""!=intervals[t].start_time){var a=intervals[t].start_time.split(":"),n=String(e.srcElement.value).split(":");a[0]>n[0]?(alert("Stop time cannot be before start time!"),e.srcElement.value=""):a[0]==n[0]&&a[1]>n[1]?(alert("Stop time cannot be before start time!"),e.srcElement.value=""):intervals[t].stop_time=e.srcElement.value}else intervals[t].stop_time=e.srcElement.value;console.log(t),console.log(intervals[t].stop_time)}function set_day(e){var t=get_interval_idx(e.srcElement.id);switch(e.srcElement.name){case"m":console.log("Monday"),e.srcElement.checked?intervals[t].days|=1:intervals[t].days&=-2;break;case"t":console.log("Tuesday"),e.srcElement.checked?intervals[t].days|=2:intervals[t].days&=-3;break;case"w":console.log("Wednesday"),e.srcElement.checked?intervals[t].days|=4:intervals[t].days&=-5;break;case"th":console.log("Thursday"),e.srcElement.checked?intervals[t].days|=8:intervals[t].days&=-9;break;case"f":console.log("Friday"),e.srcElement.checked?intervals[t].days|=16:intervals[t].days&=-17;break;case"sat":console.log("Saturday"),e.srcElement.checked?intervals[t].days|=32:intervals[t].days&=-33;break;case"sun":console.log("Sunday"),e.srcElement.checked?intervals[t].days|=64:intervals[t].days&=-65;break;case"all":console.log("All"),e.srcElement.checked?(intervals[t].days|=255,days.forEach(e=>{element=document.getElementById(e+"_"+t),element.checked=!0})):(intervals[t].days&=-256,days.forEach(e=>{element=document.getElementById(e+"_"+t),element.checked=!1}))}console.log(intervals[t].days)}function post_intervals(){var e=[];intervals.forEach(t=>{if(!t.invalidate){var a=new Object;a.id=t.id,a.days=t.days,a.start_time=t.start_time,a.stop_time=t.stop_time,e.push(a)}});for(var t=e.length;t<max_intervals;t++){var a=new Object;a.id=-1,a.days=0,a.start_time="NULL",a.stop_time="NULL",e.push(a)}console.log(JSON.stringify(e));var n=new XMLHttpRequest;n.open("POST","ts.cgi"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e)),n.onreadystatechange=function(){4==this.readyState&&200==this.status&&console.log(this.responseText)}}function post_zip(){const e=document.getElementById("zip");if(/^\d+$/.test(e.value)&&5==e.value.length){var t=new Object;t.zip=parseInt(e.value),console.log(JSON.stringify(t));var a=new XMLHttpRequest;a.open("POST","zip.cgi"),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(t)),a.onreadystatechange=function(){4==this.readyState&&200==this.status&&console.log(this.responseText)}}else alert("Invalid ZIP code. Please input 5 digits.")}function get_interval_idx(e){var t=String(e),a=t.indexOf("_")+1,n=t.length;return t.substring(a,n)}window.onload=set_trigger;